services:
  frontend:
    user: ${USERID}:${GROUPID}
    build:
      context: ${FRONTEND_FOLDER}
      dockerfile: ${FRONTEND_FOLDER}/dev.Dockerfile
      args:
        USERID: ${USERID}
        GROUPID: ${GROUPID}
    volumes:
      - ${FRONTEND_FOLDER}:/usr/app
  backend:
    # Run as root initially so entrypoint can fix permissions, then it switches to the user
    build:
      context: ${BACKEND_FOLDER}
      dockerfile: ${BACKEND_FOLDER}/dev.Dockerfile
      args:
        USERID: ${USERID}
        GROUPID: ${GROUPID}
    environment:
        DB_HOST: test-db
        DB_PORT: 5432
        DB_NAME: codymatch
        DB_USER: codymatch
        DB_PASSWORD: ${DB_PASSWORD:-codymatch}
        NODE_ENV: test
        DISABLE_HTTP_LOGS: 'true'
        CODE_RUNNER_TEMP_DIR: /tmp/code-runner
        USERID: ${USERID}
        GROUPID: ${GROUPID}
    volumes:
      - ${BACKEND_FOLDER}:/usr/app
      - /var/run/docker.sock:/var/run/docker.sock
      - code_runner_temp:/tmp/code-runner

volumes:
  code_runner_temp:
